<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Training App</title>
  <style>
    /* Основные стили из предыдущего кода остаются */
    
    /* Добавляем стили для модального окна */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal-content {
      background: #2a2a2a;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0,255,136,0.3);
    }

    .training-timer {
      font-size: 3em;
      color: #00ff88;
      margin: 20px 0;
      font-family: monospace;
    }

    .number-display {
      font-size: 4em;
      color: #fff;
      margin: 20px 0;
      letter-spacing: 8px;
    }

    .number-input {
      width: 100%;
      padding: 15px;
      font-size: 1.5em;
      text-align: center;
      background: #1a1a1a;
      border: 2px solid #00ff88;
      border-radius: 10px;
      color: white;
      margin: 20px 0;
    }

    .result-message {
      color: #00ff88;
      margin: 15px 0;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 class="header-title">Тренировка памяти</h1>
  </div>

  <!-- Основной интерфейс с нодами -->
  <div class="skill-map" id="skillMap">
    <div class="nodes-container" id="nodesContainer">
      <svg class="connectors" id="connectors"></svg>
    </div>
  </div>

  <!-- Модальное окно для тренировки -->
  <div class="modal-overlay" id="trainingModal">
    <div class="modal-content">
      <div class="number-display" id="numberDisplay"></div>
      <div class="training-timer" id="trainingTimer">00:05</div>
      <input type="number" class="number-input" id="numberInput" placeholder="Введите число" disabled>
      <div class="result-message" id="resultMessage"></div>
    </div>
  </div>

  <script>
    // Данные нод с указанием типа тренировки
    const nodes = [
      { 
        id: 1, 
        x: 500, 
        y: 500, 
        connections: [2,3], 
        text: "Уровень 1\n4 цифры", 
        locked: false,
        training: {
          digits: 4,
          time: 5
        }
      },
      { 
        id: 2, 
        x: 300, 
        y: 300, 
        connections: [4], 
        text: "Уровень 2\n5 цифр", 
        locked: true,
        training: {
          digits: 5,
          time: 4
        }
      },
      // ... остальные ноды
    ];

    // Модифицированная функция создания нод
    function createNodes() {
      const container = document.getElementById('nodesContainer');
      const connectors = document.getElementById('connectors');

      nodes.forEach(node => {
        const div = document.createElement('div');
        div.className = `node ${node.locked ? 'locked' : 'active'}`;
        div.style.left = `${node.x}px`;
        div.style.top = `${node.y}px`;
        div.innerHTML = `<div class="node-text">${node.text}</div>`;
        
        if (!node.locked) {
          div.addEventListener('click', () => {
            if(node.training) {
              startTrainingSession(node.training);
            } else {
              unlockConnectedNodes(node.id);
            }
          });
        }

        container.appendChild(div);
        // ... остальная логика соединений
      });
    }

    // Функция запуска тренировки
    function startTrainingSession(config) {
      const modal = document.getElementById('trainingModal');
      const numberDisplay = document.getElementById('numberDisplay');
      const timerElement = document.getElementById('trainingTimer');
      const inputField = document.getElementById('numberInput');
      const resultMessage = document.getElementById('resultMessage');

      // Генерация случайного числа
      const number = generateRandomNumber(config.digits);
      numberDisplay.textContent = number;
      
      // Настройка таймера
      let timeLeft = config.time;
      let timerActive = true;
      
      modal.style.display = 'flex';
      inputField.disabled = true;
      resultMessage.textContent = '';

      const timerInterval = setInterval(() => {
        timeLeft--;
        timerElement.textContent = `00:${timeLeft.toString().padStart(2, '0')}`;

        if(timeLeft <= 0) {
          clearInterval(timerInterval);
          timerActive = false;
          numberDisplay.style.display = 'none';
          inputField.disabled = false;
          inputField.focus();
        }
      }, 1000);

      // Обработчик ввода числа
      inputField.addEventListener('input', function(e) {
        if(!timerActive) {
          if(e.target.value === number) {
            resultMessage.textContent = '✅ Верно!';
            unlockConnectedNodes(currentNodeId); // Разблокировка следующих нод
            setTimeout(() => modal.style.display = 'none', 1000);
          } else {
            resultMessage.textContent = '❌ Неверно! Попробуйте ещё раз';
          }
        }
      });
    }

    function generateRandomNumber(digits) {
      return Math.floor(Math.pow(10, digits-1) + 
        Math.random() * (Math.pow(10, digits) - Math.pow(10, digits-1));
    }

    // ... остальные функции из предыдущего кода
  </script>
</body>
</html>
